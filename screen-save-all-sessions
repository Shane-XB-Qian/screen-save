#!/bin/sh
# save all my screen sessions
# Simon Walz, 2018

set -eu

ARGC=$#

defaultdir="$HOME/.screen-save/$(date --iso-8601)"
savedir=$defaultdir
if [[ "$ARGC" -gt 0 ]]; then
  savedir=$1
fi

if [[ "$savedir" =~ \-h ]]; then
	echo "usage: prog [savedir]" >&2
	echo "	savedir	- save to directory" >&2
	echo "			  default: $defaultdir" >&2
	exit 2
fi

mkdir -pv $savedir

SCREEN_PID=`screen -ls | \
	grep -oE "^\s+[0-9]+\." | \
	grep -oE "[0-9]+"`

for i in ${SCREEN_PID}
do
  $(dirname $0)/screen-save "${i}" "$savedir/$i" </dev/null
done

